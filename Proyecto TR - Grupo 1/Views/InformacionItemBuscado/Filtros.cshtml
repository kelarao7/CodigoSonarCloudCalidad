@model PagedList.IPagedList<Proyecto_TruequesUCR.Models.InformacionItemBuscado>
@using PagedList.Mvc;
@using PagedList;

@{
    ViewBag.Title = "Informacion de Items Encontrados";
}
    <head>
        <meta charset="utf-8">
        <title>Trueques &#64 UCR</title>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"
                integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
                crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="~/Content/bootstrap.css">
        <link rel="stylesheet" href="~/Content/General.css">
        <link rel="stylesheet" href="~/Content/DisplayBusqueda.css">
        <script src="~/Scripts/filtrarTrueque.js"></script>
        <link href="~/Content/PagedList.css" rel="stylesheet" type="text/css" />
    </head>


<div class="col-md-2 col-sm-2 col-xs-3">
    <div class="card">
        <article class="card-group-item">
            <h4>Filtrar por</h4>
            <header class="card-header">
                <h6 class="title">Ubicación: </h6>
            </header>
            <div class="filter-content">
                <div class="card-body">
                    <div>
                        <select id="pais">
                            <option value="">Seleccione país</option>
                            <option value="Costa Rica">Costa Rica</option>
                            <option value="Estados Unidos de América">Estados Unidos de América</option>
                        </select>
                    </div>
                    <div id="provincia"></div>
                    <div id="canton"></div>
                    <!--Aqui va el codigo de Ubicación-->

                </div> <!-- card-body.// -->
            </div>
        </article> <!-- card-group-item.// -->
        <article class="card-group-item">
            <header class="card-header">
                <h6 class="title">Calificación del truequeador: </h6>
            </header>
            <div class="filter-content">
                <div class="card-body">
                    <ul class="listaDeEstrellas">

                        <!-- 5 estrellas o más-->
                        @*if (TempData.ContainsKey("estrellas"))*@
                        @*TempData.Keep();*@


                        @{
                            var color = (int)TempData.Peek("estrellas");
                            if (color == 5)
                            {
                                <a href="#" class="seleccion-estrellas1" onclick="filtrarPorCalificacion(5)">
                                    <li>

                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i><p class="parrafoEstrellas"> exactas</p>
                                    </li>
                                </a>
                            }
                            else
                            {
                                <a href="#" class="seleccion-estrellas2" onclick="filtrarPorCalificacion(5)">
                                    <li>

                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i><p class="parrafoEstrellas"> exactas</p>
                                    </li>
                                </a>
                            }

                            <!-- 4 estrellas o más-->
                            if (color == 4)
                            {
                                <a href="#" class="seleccion-estrellas1" onclick="filtrarPorCalificacion(4)">
                                    <li>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star checked"></i> <p class="parrafoEstrellas">o más</p>
                                    </li>
                                </a>
                            }
                            else
                            {
                                <a href="#" class="seleccion-estrellas2" onclick="filtrarPorCalificacion(4)">
                                    <li>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star checked"></i> <p class="parrafoEstrellas">o más</p>
                                    </li>
                                </a>
                            }

                            <!-- 3 estrellas o más-->
                            if (color == 3)
                            {
                                <a href="#" class="seleccion-estrellas1" onclick="filtrarPorCalificacion(3)">
                                    <li>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star checked"></i>
                                        <i class="fa fa-star checked"></i> <p class="parrafoEstrellas">o más</p>
                                    </li>
                                </a>
                            }
                            else
                            {
                                <a href="#" class="seleccion-estrellas2" onclick="filtrarPorCalificacion(3)">
                                    <li>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star checked"></i>
                                        <i class="fa fa-star checked"></i> <p class="parrafoEstrellas">o más</p>
                                    </li>
                                </a>
                            }

                            <!-- 2 estrellas o más-->
                            if (color == 2)
                            {
                                <a href="#" class="seleccion-estrellas1" onclick="filtrarPorCalificacion(2)">
                                    <li>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star checked"></i>
                                        <i class="fa fa-star checked"></i>
                                        <i class="fa fa-star checked"></i> <p class="parrafoEstrellas">o más</p>
                                    </li>
                                </a>
                            }
                            else
                            {
                                <a href="#" class="seleccion-estrellas2" onclick="filtrarPorCalificacion(2)">
                                    <li>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star checked"></i>
                                        <i class="fa fa-star checked"></i>
                                        <i class="fa fa-star checked"></i> <p class="parrafoEstrellas">o más</p>
                                    </li>
                                </a>
                            }

                            <!-- 1 estrella o más-->
                            if (color == 1)
                            {
                                <a href="#" class="seleccion-estrellas1" onclick="filtrarPorCalificacion(1)">
                                    <li>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star checked"></i>
                                        <i class="fa fa-star checked"></i>
                                        <i class="fa fa-star checked"></i>
                                        <i class="fa fa-star checked"></i> <p class="parrafoEstrellas">o más</p>
                                    </li>
                                </a>
                            }
                            else
                            {
                                <a href="#" class="seleccion-estrellas2" onclick="filtrarPorCalificacion(1)">
                                    <li>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star checked"></i>
                                        <i class="fa fa-star checked"></i>
                                        <i class="fa fa-star checked"></i>
                                        <i class="fa fa-star checked"></i> <p class="parrafoEstrellas">o más</p>
                                    </li>
                                </a>
                            }
                        }
                    </ul>
                    <!--Aqui va el codigo de Estrellas-->
                </div> <!-- card-body.// -->
            </div>
        </article> <!-- card-group-item.// -->
        <article class="card-group-item">
            <header class="card-header">
                <h6 class="title">Tipo de Trueque: </h6>
            </header>
            <div class="filter-content">
                <div class="card-body">
                    <form>
                        <label class="form-check">
                            @if (ViewBag.uno == true)
                            {
                                <input class="form-check-input" onclick="filtraTrueq()" type="checkbox" value="" id="trueque_uno_uno" checked>
                            }
                            else
                            {
                                <input class="form-check-input" onclick="filtraTrueq()" type="checkbox" value="" id="trueque_uno_uno">
                            }
                            <span class="form-check-label">
                                Directo
                            </span>

                        </label> <!-- form-check.// -->

                        <label class="form-check">
                            @if (ViewBag.circular == true)
                            {
                                <input class="form-check-input" onclick="filtraTrueq()" type="checkbox" value="" id="trueque_circular" checked>
                            }
                            else
                            {
                                <input class="form-check-input" onclick="filtraTrueq()" type="checkbox" value="" id="trueque_circular">
                            }
                            <span class="form-check-label">
                                Circular
                            </span>
                        </label>  <!-- form-check.// -->

                        <label class="form-check">
                            @if (ViewBag.subasta == true)
                            {
                                <input class="form-check-input" onclick="filtraTrueq()" type="checkbox" value="" id="trueque_subasta" checked>
                            }
                            else
                            {
                                <input class="form-check-input" onclick="filtraTrueq()" type="checkbox" value="" id="trueque_subasta">
                            }
                            <span class="form-check-label">
                                Subasta
                            </span>
                        </label>  <!-- form-check.// -->


                    </form>

                </div> <!-- card-body.// -->
            </div>
        </article> <!-- card-group-item.// -->


        @* Filtrar por estado del producto *@
        <article class="card-group-item">
            <header class="card-header">
                <h6 class="title">Estado del producto: </h6>
            </header>
            <div class="filter-content">
                <div class="card-body">
                    <form>

                        <label class="form-check">
                            @if (ViewBag.nuevo == true)
                            {
                                <input class="form-check-input" onclick="filtraEstadoProducto()" type="checkbox" value="" id="trueque_nuevo" checked>
                            }
                            else
                            {
                                <input class="form-check-input" onclick="filtraEstadoProducto()" type="checkbox" value="" id="trueque_nuevo">
                            }
                            <span class="form-check-label">
                                Nuevo
                            </span>

                        </label> <!-- form-check.// -->

                        <label class="form-check">
                            @if (ViewBag.casiNuevo == true)
                            {
                                <input class="form-check-input" onclick="filtraEstadoProducto()" type="checkbox" value="" id="trueque_casiNuevo" checked>
                            }
                            else
                            {
                                <input class="form-check-input" onclick="filtraEstadoProducto()" type="checkbox" value="" id="trueque_casiNuevo">
                            }
                            <span class="form-check-label">
                                Casi Nuevo
                            </span>
                        </label>  <!-- form-check.// -->

                        <label class="form-check">
                            @if (ViewBag.bueno == true)
                            {
                                <input class="form-check-input" onclick="filtraEstadoProducto()" type="checkbox" value="" id="trueque_bueno" checked>
                            }
                            else
                            {
                                <input class="form-check-input" onclick="filtraEstadoProducto()" type="checkbox" value="" id="trueque_bueno">
                            }
                            <span class="form-check-label">
                                Bueno
                            </span>
                        </label>  <!-- form-check.// -->

                        <label class="form-check">
                            @if (ViewBag.regular == true)
                            {
                                <input class="form-check-input" onclick="filtraEstadoProducto()" type="checkbox" value="" id="trueque_regular" checked>
                            }
                            else
                            {
                                <input class="form-check-input" onclick="filtraEstadoProducto()" type="checkbox" value="" id="trueque_regular">
                            }
                        <span class="form-check-label">
                            Regular
                        </span>
                        </label>  <!-- form-check.// -->

                        <label class="form-check">
                            @if (ViewBag.malo == true)
                            {
                                <input class="form-check-input" onclick="filtraEstadoProducto()" type="checkbox" value="" id="trueque_malo" checked>
                            }
                            else
                            {
                                <input class="form-check-input" onclick="filtraEstadoProducto()" type="checkbox" value="" id="trueque_malo">
                            }
                        <span class="form-check-label">
                            Malo
                        </span>
                        </label>  <!-- form-check.// -->
                    </form>
                </div> <!-- card-body.// -->
            </div>
        </article> <!-- card-group-item.// -->
        @* Fin de filtrar por estado del producto *@


        <article class="card-group-item">
            <header class="card-header">
                <h6 class="title">Limpiar filtros: </h6>
            </header>
            <div class="filter-content">
                <div class="card-body">


                    <a onclick="limpiarFiltros()" class="btn btn-success" style="width:100%; color :white;" id="limpiarFiltrosBtn">

                        <span>
                            <strong>Limpiar</strong>
                        </span>
                    </a>

                </div>
            </div>
        </article>
    </div> <!-- card.// -->
</div><!-- col -->


<script>
    function filtrarPorCalificacion(estrellas) {
             if (estrellas == 5) {
                 var url = '@Url.Action("filtrarResultadoDeBusquedaPorCalificacion", "InformacionItemBuscado", new {cantidadEstrellas = 5})';
             } else if (estrellas == 4) {
                 var url = '@Url.Action("filtrarResultadoDeBusquedaPorCalificacion", "InformacionItemBuscado", new {cantidadEstrellas = 4})';
             } else if (estrellas == 3) {
                 var url = '@Url.Action("filtrarResultadoDeBusquedaPorCalificacion", "InformacionItemBuscado", new {cantidadEstrellas = 3})';
             } else if (estrellas == 2) {
                 var url = '@Url.Action("filtrarResultadoDeBusquedaPorCalificacion", "InformacionItemBuscado", new {cantidadEstrellas = 2})';
             } else if (estrellas == 1) {
                 var url = '@Url.Action("filtrarResultadoDeBusquedaPorCalificacion", "InformacionItemBuscado", new {cantidadEstrellas = 1})';
        }
        //selectedStars(estrellas);
        window.location.href = url;

    }

    $(document).ready(function () {
        var url = window.location.href;
        var paisIndex = url.indexOf('pais=');
        if (paisIndex != -1) {
            var endIndex = url.indexOf('&', paisIndex + 5);
            if (endIndex != -1) {
                var paisParam = url.substring(paisIndex + 5, endIndex);
            }
            else {
                var paisParam = url.substring(paisIndex + 5);
            }


            paisParam = decodeURI(paisParam); //********


            if (paisParam) {
                $("#pais").val(paisParam);
                if (paisParam == "Costa Rica") {
                    $.ajax({
                        dataType: "json",
                        data: [],
                        url: "https://ubicaciones.paginasweb.cr/provincias.json",
                        type: 'GET',
                        crossDomain: true,
                        success: function (data) {
                            agregarProvincias(data);
                        }
                    });
                }

            }
        }

        $("#pais").change(function () {
            var pais = this.value;
            filtrarPorUbicacion(pais, null, null);
        });
    });



    $(document).on('change', '#provincia > select', function () {
        var pais = $('#pais').val();
        var provincia = $("#provincia option:selected").text();

        filtrarPorUbicacion(pais, provincia, null);


    });

    $(document).on('change', '#canton > select', function () {
        var pais = $('#pais').val();
        var provincia = $("#provincia option:selected").text();
        var canton = $("#canton option:selected").text();

        filtrarPorUbicacion(pais, provincia, canton);


    });

</script>